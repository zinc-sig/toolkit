---
platform: linux
image_resource:
  type: registry-image
  source:
    repository: busybox
inputs:
  - name: submission
  - name: compilation-output
  - name: assignment-assets
  - name: ghost
outputs:
  - name: execution-output
params:
  EXECUTION_BINARY: ((execution_binary))
  EXECUTION_FLAGS: ((execution_flags))
  INPUT_PATH: ((input_path))
  OUTPUT_PATH: ((output_path))
  STDERR_PATH: ((stderr_path))
  SCORE: ((score))
run:
  path: sh
  args:
    - -c
    - |
      # Make ghost executable
      chmod +x ghost/ghost-linux-amd64

      # Note: OUTPUT_PATH and STDERR_PATH should now be simple filenames or relative paths
      # as they will be uploaded directly to the configured bucket location
      ./ghost/ghost-linux-amd64 run --verbose \
        -i "${INPUT_PATH}" \
        -o "execution-output/${OUTPUT_PATH}:${OUTPUT_PATH}" \
        -e "execution-output/${STDERR_PATH}:${STDERR_PATH}" \
        --score "${SCORE}" \
        -- ${EXECUTION_BINARY} ${EXECUTION_FLAGS}
